#!/usr/bin/env python3
"""Final verification before deployment"""

import sys
import os
sys.path.append(os.path.dirname(os.path.abspath(__file__)))

from semantic_sentiment_analyzer import SemanticSentimentAnalyzer

print("=" * 80)
print("ЁЯФН FINAL VERIFICATION - Testing Exact User Scenario")
print("=" * 80)

analyzer = SemanticSentimentAnalyzer()

# Test with the exact input that was showing the problem
test_text = "ропро╛родрпБроорпН роКро░рпЗ ропро╛ро╡ро░рпБроорпН роХрпЗро│ро┐ро░рпН родрпАродрпБроорпН роиройрпНро▒рпБроорпН рокро┐ро▒ро░рпНродро░ ро╡ро╛ро░ро╛"

print(f"\nЁЯУЭ Testing with: {test_text}")
print(f"{'='*80}\n")

result = analyzer.analyze_semantic_sentiment(test_text)

semantic = result.get('semantic_analysis', {})
meaning = semantic.get('meaning', '')
source_book = semantic.get('source_book', '')
enhanced = result.get('enhanced_analysis', False)

print(f"тЬЕ Analysis Complete!")
print(f"\n{'='*80}")
print(f"RESULTS:")
print(f"{'='*80}")

print(f"\n1я╕ПтГг Enhanced Analysis Used: {enhanced}")
print(f"2я╕ПтГг Source Book: {source_book}")
print(f"3я╕ПтГг Meaning Length: {len(meaning)} characters")

print(f"\n{'='*80}")
print(f"рокрпКро░рпБро│рпН (MEANING):")
print(f"{'='*80}")
print(meaning)
print(f"{'='*80}")

# Check if it's the bad output or good output
if "роЙро░рпИропро┐ройрпН родрпЖро│ро┐ро╡ро╛рой ро╡ро┐ро│роХрпНроХроорпН" in meaning and len(meaning) < 200:
    print(f"\nтЭМ FAILED - Still showing generic fallback!")
    print(f"   This is the BAD output you don't want.")
    sys.exit(1)
elif "роирпВро▓рпН:" in meaning and len(meaning) > 500:
    print(f"\nтЬЕ SUCCESS - Showing detailed Gemini output!")
    print(f"   This is the GOOD output you want.")
    print(f"\n   Contains:")
    if source_book:
        print(f"   тЬУ Source Book: {source_book}")
    if 'chapter_section' in semantic:
        print(f"   тЬУ Chapter/Section: {semantic.get('chapter_section')}")
    if 'verse_number' in semantic:
        print(f"   тЬУ Verse Number: {semantic.get('verse_number')}")
    print(f"   тЬУ Detailed meaning: {len(meaning)} characters")
else:
    print(f"\nтЪая╕П UNCERTAIN - Output format unexpected")
    print(f"   Length: {len(meaning)} characters")
    print(f"   Enhanced: {enhanced}")

print(f"\n{'='*80}")
print(f"READY FOR DEPLOYMENT: {'YES тЬЕ' if enhanced and len(meaning) > 500 else 'NO тЭМ'}")
print(f"{'='*80}\n")
